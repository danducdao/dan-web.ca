
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<style>
    .details-control:hover{
        cursor:pointer;
    }
</style>
<h2>Categories</h2>
<table id="category" class="ui collapsing table">
    <thead>
        <tr>
            <th></th>
            <th>Name</th>
            <th>Description</th>
        </tr>
    </thead>
</table>
@section scripts{
    <script>
        function format(data) {
            var html = "<table cellpadding='0' cellspacing='0' border='0'>";
            html += "<thead>";
            html += "<tr>";
            html += "<th>Name</th>";
            html += "<th>Price</th>";
            html += "<th>Qte</th>";
            html += "</tr>"
            html += "</thead>";
            html += "<tbody>";
            data.Products.forEach(function (product) {
                html += "<tr>";
                html += "<td>" + product.ProductName + "</td>";
                html += "<td>" + product.UnitPrice + "</td>";
                html += "<td>" + product.UnitsInStock + "</td>";
                html += "</tr>";
            });
            html += "</tbody>"
            html += "</table>";
            return html;
        }
        $(document).ready(function() {
            var table = $('#category').DataTable({
                ajax: "http://webapi.com/category",
                method: "GET",
                paging: false,
                searching: false,
                ordering:  false,
                columns: [
                    { "className":"details-control",
                      "orderable":false,
                      "data":null,
                      "defaultContent":"<i class='plus circle icon green'></i>"
                    },
                    { "data": "CategoryName" },
                    { "data" : "Description"}
                ]
            });
            $('#category tbody').on('click', 'td.details-control', function () {
                var tr = $(this).closest('tr');
                var row = table.row( tr );
               
               if ( row.child.isShown() ) {
                   // This row is already open - close it
                   row.child.hide();
                   tr.removeClass('shown');
                   $(this).html("<i class='plus circle icon green'></i>");
                }
               else {
                    // Open this row
                    row.child( format(row.data()) ).show();
                   tr.addClass('shown');
                   $(this).html("<i class='minus circle icon red'></i>");
                }
            });
        });
    </script>
}

